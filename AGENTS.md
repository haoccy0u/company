# AGENTS.md

## 目的
本文件定义 Codex 在本 Godot 项目中的协作方式。
核心目标：快速迭代、减少回归、变更可追踪。

## 项目背景
- 引擎版本：Godot 4.6（见 `project.godot`）
- 当前业务核心：`scripts/inventory/` 下的 inventory 系统

## 路径说明
- `scripts/inventory/`：库存系统核心逻辑（长期维护范围）
- `scripts/cursor/`：鼠标携带物品相关逻辑
- `resource/`：资源与数据文件
- `scenes/invtest/`：仅用于 inventory 系统测试的临时场景与脚本，不属于长期规范约束范围

## Codex 协作规则
- 合作者的代码水平不高，用新手能理解的方式解释为什么改动，以及改动是如何实现的
- 先读后改：先阅读相关文件，根据需求分析并拆解问题，再提出修改方案。得到确认后再修改。
- 最小改动：优先采用最小、安全、可验证的补丁。
- 非明确要求，不改变现有行为。
- 未经明确要求，不重命名文件、类名、节点路径、信号名。
- 优先保证与现有场景连接关系兼容，避免大规模架构改写。

## GDScript 约定
- 尽量使用类型标注（变量类型、返回值类型）。
- 函数保持单一职责；仅在可读性明显提升时提取函数。
- 在 `_ready`、`_process`、输入处理中避免隐式副作用。
- 对空引用和缺失节点使用明确的 guard clause。
- 注释简洁，说明意图，不写显而易见的注释。

## 变更验证要求
每次改动后，Codex 应：
- 优先执行与改动点直接相关的验证。
- 明确说明“已验证项 / 未验证项”。
- 若无法直接运行验证，提供可执行的人工验证步骤。

## 提交与变更卫生
- 一次改动只解决一个目标问题。
- 输出需包含：修改文件、行为影响、风险、后续建议。
- 上下文不足时，明确列出假设条件。

## 任务描述模板（建议）
向 Codex 提需求时建议包含：

1. 目标：希望改变什么行为。
2. 范围：允许修改的文件路径。
3. 约束：哪些行为或接口不能动。
4. 验收：可判定通过/失败的标准。
5. 输出：需要的结果格式（例如摘要、补丁、验证结果）。

## 当前已知风险
- 终端中部分中文注释可能出现乱码（疑似编码显示问题）。
- 代码中对组名和节点路径的耦合较强（如 `hud`、`player`、`PlayerInv`），修改时需谨慎。
