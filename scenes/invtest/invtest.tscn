[gd_scene format=3 uid="uid://c6su24ieu6iav"]

[ext_resource type="Script" uid="uid://brfxesw8q3g6f" path="res://invtest.gd" id="1_0gu2n"]

[sub_resource type="GDScript" id="GDScript_0gu2n"]
script/source = "extends Node

func _ready():
	var stone := ItemData.new()
	stone.item_id = &\"stone\"
	stone.max_stack = 64
	stone.item_name = \"Stone\"

	var wood := ItemData.new()
	wood.item_id = &\"wood\"
	wood.max_stack = 64
	wood.item_name = \"Wood\"

	var c := ItemContainer.new()
	c.slot_count = 3
	c.try_insert(stone, 70) # slot0=64, slot1=6

	var s := InventorySession.new()

	print(\"=== Initial ===\")
	_print(c, s)

	# 1) cursor 空，右键 slot0：拿一半 32
	s.right_click(c, 0)
	print(\"\\n=== Right click slot0 (take half) ===\")
	_print(c, s)  # 期待：cursor 32, slot0 32

	# 2) cursor 有 stone，右键 slot0（同物品）：放 1
	s.right_click(c, 0)
	print(\"\\n=== Right click slot0 (place 1 to same stack) ===\")
	_print(c, s)  # 期待：cursor 31, slot0 33

	# 3) cursor 有 stone，右键 slot2（空）：放 1
	s.right_click(c, 2)
	print(\"\\n=== Right click slot2 (place 1 to empty) ===\")
	_print(c, s)  # 期待：cursor 30, slot2 stone1

	# 4) cursor 改成 wood20，右键 slot0（不同物品）：应无变化（不 swap）
	s.cursor.item = wood
	s.cursor.count = 20
	s.right_click(c, 0)
	print(\"\\n=== Right click slot0 with different item (should do nothing) ===\")
	_print(c, s)

func _print(c: ItemContainer, s: InventorySession) -> void:
	for i in range(c.slots.size()):
		var slot := c.slots[i]
		var id := slot.item.item_id if slot.item != null else &\"<empty>\"
		print(\"slot\", i, \": \", id, \" x\", slot.count)

	if s.cursor.is_empty():
		print(\"cursor: <empty>\")
	else:
		print(\"cursor: \", s.cursor.item.item_id, \" x\", s.cursor.count)
"

[node name="invtest" type="Node2D" unique_id=940134352]
script = ExtResource("1_0gu2n")

[node name="Node" type="Node" parent="." unique_id=1377812984]
script = SubResource("GDScript_0gu2n")
